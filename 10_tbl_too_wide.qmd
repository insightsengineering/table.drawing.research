---
title: "Table Too Wide"
format: html
editor: visual
---

## Testing output when the table is too long

```{r eval=FALSE}
library(gtsummary)
library(dplyr)

set.seed(123)
data <- tibble(
  id = 1:100,
  age = sample(18:90, 100, replace = TRUE),
  sex = sample(c("Male", "Female"), 100, replace = TRUE),
  race = sample(c("White", "Black", "Asian", "Hispanic"), 100, replace = TRUE),
  bmi = round(runif(100, 18, 35), 1),
  smoking_status = sample(c("Never", "Former", "Current"), 100, replace = TRUE),
  diabetes = sample(c("Yes", "No"), 100, replace = TRUE),
  hypertension = sample(c("Yes", "No"), 100, replace = TRUE),
  heart_disease = sample(c("Yes", "No"), 100, replace = TRUE),
  cancer = sample(c("Yes", "No"), 100, replace = TRUE),
  cholesterol = sample(c("Normal", "High"), 100, replace = TRUE),
  exercise_frequency = sample(0:7, 100, replace = TRUE),
  alcohol_intake = sample(c("None", "Low", "Moderate", "High"), 100, replace = TRUE),
  family_history = sample(c("Yes", "No"), 100, replace = TRUE),
  education = sample(c("High School", "College", "Graduate", "Post-Grad", "Middle School", "Elementary School", "Pre School", "Kindergarten"), 100, replace = TRUE),
  marital_status = sample(c("Single", "Married", "Divorced"), 100, replace = TRUE),
  employment_status = sample(c("Employed", "Unemployed", "Retired"), 100, replace = TRUE),
  region = sample(c("North", "South", "East", "West"), 100, replace = TRUE),
  health_insurance = sample(c("Yes", "No"), 100, replace = TRUE),
  medication = sample(c("Yes", "No"), 100, replace = TRUE),
  visits_last_year = sample(0:10, 100, replace = TRUE),
  satisfaction = sample(1:5, 100, replace = TRUE)
)

# Create a wide summary table
summary_table <- data %>%
  tbl_summary(
    by = education,
    statistic = list(all_continuous() ~ "{mean} ({sd})", 
                     all_categorical() ~ "{n} ({p}%)"),
    label = list(
      age ~ "Age (years)",
      bmi ~ "BMI",
      smoking_status ~ "Smoking Status",
      diabetes ~ "Diabetes",
      hypertension ~ "Hypertension",
      heart_disease ~ "Heart Disease",
      cancer ~ "Cancer",
      cholesterol ~ "Cholesterol",
      exercise_frequency ~ "Exercise Frequency (days/week)",
      alcohol_intake ~ "Alcohol Intake",
      family_history ~ "Family History",
      marital_status ~ "Marital Status",
      employment_status ~ "Employment Status",
      region ~ "Region",
      health_insurance ~ "Health Insurance",
      medication ~ "On Medication",
      visits_last_year ~ "Visits Last Year",
      satisfaction ~ "Health Satisfaction (1-5)"
    )
  ) %>%
  add_n() %>%
  modify_header(label = "**Characteristic**", estimate = "**Mean (SD) or N (%)**") %>%
  modify_table_styling(columns = everything()) %>%
  add_overall()  # This adds an overall column
```

### gt_save PDF

```{r eval = FALSE}
gt::gtsave(as_gt(summary_table), filename = "outputs/pdf/too_wide_gt_pdf.pdf")
```

[Preview the Output](outputs/pdf/too_wide_gt_pdf.pdf)

-   table cut off at the end of the page (portrait)

### rmarkdown rendered PDF

```{r eval = FALSE}
summary_table
```

[Preview the Output](outputs/pdf/too_wide_rmd_pdf.pdf)

-   table cut off at the end of the page (portrait)

### gt_save rendered word file

```{r eval = FALSE}
gt::gtsave(as_gt(summary_table), filename = "outputs/docx/too_wide_gt_word.docx")
```

[Preview the Output](outputs/docx/too_wide_gt_word.docx) - table condensed (squished) to fit on the page (text wrapping within cells)

### quarto rendered word file

```{r eval = FALSE}
gt_table
```

[Preview the Output](outputs/docx/too_wide_qmd_word.docx) - table condensed (squished) to fit on the page (text wrapping within cells)

### rmarkdown rendered word file

```{r eval = FALSE}
gt_table
```

[Preview the Output](outputs/docx/too_wide_rmd_word.docx)

-   table condensed (squished) to fit on the page (text wrapping within cells)


## Modifying the gt table

Customization using gt functions may be used to work around issues with pagination when exporting to `docx` file.

Namely:
- `width()` for adjusting the width of the columns
- `opt_horizontal_padding()` option to adjust horizontal padding
- changing font size

[Preview the Output](outputs/docx/too_wide_rmd_word.docx)

```{r}
library(survival)
library(gtsummary)
library(gt)

# wide table, no modifications
tbl <- list(survfit(Surv(ttdeath, death) ~ trt, trial),
survfit(Surv(ttdeath, death) ~ grade, trial)) %>%
tbl_survfit(times = c(2,4,6,8,10,12,24,36.48),
label_header = "**{time} Month**") %>%
add_p()

tbl

gt::gtsave(as_gt(tbl), filename = "outputs/docx/too_wide_gt_word_wo_mod.docx")

# wide table with modifications
tbl2 <- list(survfit(Surv(ttdeath, death) ~ trt, trial),
survfit(Surv(ttdeath, death) ~ grade, trial)) %>%
tbl_survfit(times = c(2,4,6,8,10,12,24,36.48),
label_header = "**{time} Month**") %>%
add_p() |>
  as_gt()|>
 tab_options(
    table.font.size = px(5),            # Adjust the general font size of the table
    column_labels.font.size = px(5),    # Adjust the column labels font size
    table.width = pct(100)                # Adjust the table width (percentage of the page width)
  ) 

tbl2

gt::gtsave(tbl2, split = TRUE, filename = "outputs/docx/too_wide_gt_word_font.docx")


# This works in the console but when exported, the table is blank
tbl3 <- tbl2 |>
   # Adjust padding for the body cells (use the correct padding style here)
  tab_style(
    style = list(
      cell_text(
        size = px(5)  # Apply padding to text in body cells
      )
    ),
    locations = cells_body()  # Apply padding to all body cells
  )

tbl3

gt::gtsave(tbl3, split = TRUE, filename = "outputs/docx/too_wide_gt_word_padding.docx")

# when adding padding to the column labels, title disappears in the export
tbl4 <- tbl2 |>
  tab_style(
    style = list(
      cell_text(
        size = px(10)  # Apply padding to column labels
      )
    ),
    locations = cells_column_labels()  # Apply padding to column labels
  )

tbl4

gt::gtsave(tbl4, split = TRUE, filename = "outputs/docx/too_wide_gt_word_padding_cols.docx")

```

[Preview the Output - Without Modification](outputs/docx/too_wide_gt_word_wo_mod.docx)
[Preview the Output - Modify Font and Table Width](outputs/docx/too_wide_gt_word_font.docx)
[Preview the Output - Modify Padding](outputs/docx/too_wide_gt_word_padding.docx)
[Preview the Output - Modify Column Padding](outputs/docx/too_wide_gt_word_padding_cols.docx)
